<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.7.2                                              -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.bio.ed.ac.uk/                                        -->
<beast>

	<taxa id="taxa">
		<taxon id="human">
			<attr name="X">1 2</attr>
		</taxon>
		<taxon id="chimp">
			<attr name="X">1.1 12</attr>
		</taxon>
		<taxon id="bonobo">
			<attr name="X">0.9 2</attr>
		</taxon>
		<taxon id="gorilla">
			<attr name="X">1 5</attr>
		</taxon>
		<taxon id="orangutan">
			<attr name="X">1.1 1</attr>
		</taxon>
		<taxon id="siamang">
			<attr name="X">1 2.5</attr>
		</taxon>
	</taxa>

	<newick id="startingTree">
        ((((human:0.024003,(chimp:0.010772,bonobo:0.010772):0.013231):0.012035,gorilla:0.036038):0.033087000000000005,orangutan:0.069125):0.030456999999999998,siamang:0.099582)
	</newick>

	<!-- Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<coalescentTree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
		<nodeTraits name="X.tipTraits" rootNode="false" internalNodes="false" leafNodes="true" traitDimension="2" asMatrix="true">
			<parameter id="X.leafTraits"/>
		</nodeTraits>
	</treeModel>

    <multivariateDiffusionModel id="X.diffusionModel">
        <precisionMatrix>
            <compoundSymmetricMatrix id="X.precisionMatrix" asCorrelation="true" isCholesky="true">
                <diagonal>
                    <parameter id="X.precision.diagonal" value="1.0 1.0406214252904262" lower="0 0"/>
                </diagonal>
                <offDiagonal>
                    <parameter id="X.precision.offDiagonal" value="0.03739304616190829"/>
                </offDiagonal>
            </compoundSymmetricMatrix>
        </precisionMatrix>
	</multivariateDiffusionModel>

    <LKJCorrelationPrior id="X.precision.offDiagonal.prior" shapeParameter="1.0" dimension="2">
		<data>
            <parameter idref="X.precision.offDiagonal"/>
		</data>
	</LKJCorrelationPrior>

    <compoundSymmetricMatrix id="X.attenuation.matrix" asCorrelation="true" isCholesky="true">
        <diagonal>
            <parameter id="X.attenuation.values" value="10.0    16.0" lower="0 0"/>
        </diagonal>
        <offDiagonal>
            <parameter id="X.attenuation.vectors" value="0.8"/>
        </offDiagonal>
    </compoundSymmetricMatrix>

	<integratedFactorModel id="X.factorModel" traitName="X" nugget="0">
		<loadings>
			<matrixParameter id="X.loadings">
				<parameter value="1.0 0.0"/>
				<parameter value="0.0 1.0"/>
			</matrixParameter>
		</loadings>
		<precision>
			<parameter id="X.sampling.precision" value="1.0553888828920017  0.001" lower="0"/>
		</precision>
		<treeModel idref="treeModel"/>
		<traitParameter>
			<parameter idref="X.leafTraits"/>
		</traitParameter>
	</integratedFactorModel>

    <traitDataLikelihood id="X.traitLikelihood" traitName="X" 
        useTreeLength="false" scaleByTime="true" 
        forceFullPrecision="true"
        reportAsMultivariate="true" integrateInternalTraits="true">
		<multivariateDiffusionModel idref="X.diffusionModel"/>
		<transformedTreeModel>
		    <treeModel idref="treeModel"/>
		    <parameter id="X.lambda" value="1.0" lower="0.0" upper="1.0"/>
		</transformedTreeModel>
		<conjugateRootPrior>
            <meanParameter>
                <parameter value="0.0 0.0"/>
            </meanParameter>
            <priorSampleSize>
                <parameter value="0.001"/> <!-- 1 is probably a good number -->
            </priorSampleSize>
		</conjugateRootPrior>
        <optimalTraits id="X.opt">
            <strictClockBranchRates>
                <rate>
                    <parameter id="X.opt.1" value="7.918622011218901"/>
                </rate>
            </strictClockBranchRates>
            <strictClockBranchRates>
                <rate>
                    <parameter id="X.opt.2" value="12.165513214056269"/>
                </rate>
            </strictClockBranchRates>
        </optimalTraits>
        <strengthOfSelectionMatrix>
            <matrixParameter idref="X.attenuation.matrix"/>
        </strengthOfSelectionMatrix>
		<integratedFactorModel idref="X.factorModel"/>
	</traitDataLikelihood>

	<report>
        Likelihood
        <!-- <traitDataLikelihood idref="X.traitLikelihood"/> -->
        <integratedFactorModel idref="X.factorModel"/>
	</report>
	
	<correlation id="X.correlation" dimension1="1" dimension2="1">
		<matrixParameter idref="X.precisionMatrix"/>
	</correlation>

	<!-- Define operators                                                        -->
	<operators id="operators" optimizationSchedule="log">
		<randomWalkOperator windowSize="0.1" weight="20" boundaryCondition="log">
			<parameter idref="X.sampling.precision"/>
		</randomWalkOperator>
        <randomWalkOperator windowSize="0.1" weight="20" boundaryCondition="log">
            <parameter idref="X.precision.diagonal"/>
        </randomWalkOperator>
        <randomWalkOperator windowSize="0.1" weight="20">
            <parameter idref="X.precision.offDiagonal"/>
            <LKJTransform dimension="2"/>
        </randomWalkOperator>
		<randomWalkOperator windowSize="0.1" weight="40" boundaryCondition="log">
			<parameter idref="X.attenuation.values"/>
		</randomWalkOperator>
		<randomWalkOperator windowSize="0.1" weight="10">
			<parameter idref="X.attenuation.vectors"/>
			<LKJTransform dimension="2"/>
		</randomWalkOperator>
		<randomWalkOperator windowSize="0.1" weight="10">
			<parameter idref="X.opt.1"/>
		</randomWalkOperator>
		<randomWalkOperator windowSize="0.1" weight="10">
			<parameter idref="X.opt.2"/>
		</randomWalkOperator>
	</operators>

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="1" autoOptimize="true">
		<posterior id="posterior">
			<prior id="prior">
				<halfTPrior id="X.sampling.precision.diagonal.prior" df="1" scale="2.5">
					<parameter idref="X.sampling.precision"/>
				</halfTPrior>
				<!-- <betaPrior shape="2.0" shapeB="2.0" offset="0.0"> -->
				<!-- 	<parameter idref="X.lambda"/> -->
				<!-- </betaPrior> -->
				<!-- <multivariateWishartPrior idref="X.precisionPrior"/> -->
                <LKJCorrelationPrior idref="X.precision.offDiagonal.prior"/>
                <!-- <gammaPrior id="X.precision.diagonal.prior" shape="1" scale="2"> -->
                <!--     <parameter idref="X.precision.diagonal"/> -->
                <!-- </gammaPrior> -->
                <!-- <inverseGammaPrior id="X.precision.diagonal.prior" shape="0.1" scale="0.1"> -->
                <!--     <parameter idref="X.precision.diagonal"/> -->
                <!-- </inverseGammaPrior> -->
                <!-- <logNormalPrior mean="0.1" stdev="1.0" offset="0.0" meanInRealSpace="false"> -->
                <!--     <parameter idref="X.precision.diagonal"/> -->
                <!-- </logNormalPrior> -->
                <halfTPrior id="X.precision.diagonal.prior" df="1" scale="2.5">
                    <parameter idref="X.precision.diagonal"/>
                </halfTPrior>
                <!-- 7.07306 = 20*log(2)/qhnorm(0.95) : t_1/2 is longer than 5% of the tree height 95% of the time -->
                <halfNormalPrior id="X.attenuation.values.prior" mean="0.0" stdev="7.07306">
                    <parameter idref="X.attenuation.values"/>
                </halfNormalPrior>
                <LKJCorrelationPrior id="X.attenuation.vectors.prior" shapeParameter="1.0" dimension="2">
                    <data>
                        <parameter idref="X.attenuation.vectors"/>
                    </data>
                </LKJCorrelationPrior>
                <normalPrior id="X.opt.1.prior" mean="0" stdev="5">
                    <parameter idref="X.opt.1"/>
                </normalPrior>
                <normalPrior id="X.opt.2.prior" mean="0" stdev="5">
                    <parameter idref="X.opt.2"/>
                </normalPrior>
			</prior>
			<likelihood id="likelihood">
<!--				<treeLikelihood idref="treeLikelihood"/>  -->
				<traitDataLikelihood idref="X.traitLikelihood"/> 
				<integratedFactorModel idref="X.factorModel"/>
			</likelihood>
		</posterior>
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1">
			<column label="Posterior" dp="4" width="12">
				<posterior idref="posterior"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column>
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="rootHeight" sf="6" width="12">
				<parameter idref="treeModel.rootHeight"/>
			</column>
			<!-- <column label="X.lambda" sf="6" width="12"> -->
			<!-- 	<parameter idref="X.lambda"/> --> 
			<!-- </column> -->
		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog" logEvery="1" fileName="SHCA661_ou_symmetric_factor.log" overwrite="false">
			<posterior idref="posterior"/>
			<prior idref="prior"/>
			<prior idref="X.precision.diagonal.prior"/>
			<prior idref="X.precision.offDiagonal.prior"/>
			<prior idref="X.attenuation.values.prior"/>
			<prior idref="X.attenuation.vectors.prior"/>
			<prior idref="X.opt.1.prior"/>
			<prior idref="X.opt.2.prior"/>
			<likelihood idref="likelihood"/>
			<matrixParameter idref="X.precisionMatrix"/>
            <matrixParameter idref="X.precision.diagonal"/>
            <matrixParameter idref="X.precision.offDiagonal"/>
            <parameter idref="X.opt.1"/>
            <parameter idref="X.opt.2"/>
            <matrixParameter idref="X.attenuation.matrix"/>
            <parameter idref="X.attenuation.values"/>
            <matrixParameter idref="X.attenuation.vectors"/>
            <traitDataLikelihood idref="X.traitLikelihood"/>
				<integratedFactorModel idref="X.factorModel"/>
			<parameter idref="X.sampling.precision"/>
		</log>

		<!-- write tree log to file                                                  -->
		<!-- <logTree id="treeFileLog" logEvery="500000" nexusFormat="true" fileName="SHCA661_ou_symmetric_factor.trees" sortTranslationTable="true"> -->
		<!-- 	<treeModel idref="treeModel"/> -->
		<!-- 	<multivariateDiffusionModel idref="X.diffusionModel"/> -->   
            <!-- <traitDataLikelihood idref="X.traitLikelihood"/> -->
		<!-- 		<integratedFactorModel idref="X.factorModel"/> -->
		<!-- 	<posterior idref="posterior"/> -->
		<!-- </logTree> -->
	</mcmc>
	<!-- <marginalLikelihoodEstimator chainLength="2000000" pathSteps="64" pathScheme="betaquantile" alpha="0.30"> -->
	<!-- 	<samplers> -->
	<!-- 		<mcmc idref="mcmc"/> -->
	<!-- 	</samplers> -->
	<!-- 	<pathLikelihood id="pathLikelihood"> -->
	<!-- 		<source> -->
	<!-- 			<posterior idref="posterior"/> -->
	<!-- 		</source> -->
	<!-- 		<destination> -->
	<!-- 			<prior idref="prior"/> -->
	<!-- 		</destination> -->
	<!-- 	</pathLikelihood> -->
	<!-- 	<log id="MLE" logEvery="250" fileName="SHCA661_ou_symmetric_factor.MLE.log"> -->
	<!-- 		<pathLikelihood idref="pathLikelihood"/> -->
	<!-- 	</log> -->
	<!-- </marginalLikelihoodEstimator> -->
    <!-- <marginalLikelihoodEstimator chainLength="250000" pathSteps="50" pathScheme="betaquantile" alpha="0.3"> -->
		<!-- <samplers> -->
			<!-- <mcmc idref="mcmc"/> -->
		<!-- </samplers> -->
		<!-- <pathLikelihood id="pathLikelihood.GSS"> -->
			<!-- <source> -->
				<!-- <posterior idref="posterior"/> -->
			<!-- </source> -->
			<!-- <destination> -->
				<!-- <workingPrior> -->
					<!-- <logTransformedNormalReferencePrior id="X.sampling.precision.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.sampling.precision" dimension="2" burnin="200000"> -->
						<!-- <parameter idref="X.sampling.precision"/> -->
					<!-- </logTransformedNormalReferencePrior> -->
					<!-- <logTransformedNormalReferencePrior id="X.precision.diagonal.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.precision.diagonal" dimension="2" burnin="200000"> -->
						<!-- <parameter idref="X.precision.diagonal"/> -->
					<!-- </logTransformedNormalReferencePrior> -->
					<!-- <normalReferencePrior id="X.precision.offDiagonal.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.precision.offDiagonal" dimension="1" burnin="200000"> -->
						<!-- <parameter idref="X.precision.offDiagonal"/> -->
					<!-- </normalReferencePrior> -->
					<!-- <normalReferencePrior id="X.opt.1.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.opt.1" dimension="1" burnin="200000"> -->
						<!-- <parameter idref="X.opt.1"/> -->
					<!-- </normalReferencePrior> -->
					<!-- <normalReferencePrior id="X.opt.2.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.opt.2" dimension="1" burnin="200000"> -->
						<!-- <parameter idref="X.opt.2"/> -->
					<!-- </normalReferencePrior> -->
					<!-- <logTransformedNormalReferencePrior id="X.attenuation.values.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.attenuation.values" dimension="2" burnin="200000"> -->
						<!-- <parameter idref="X.attenuation.values"/> -->
					<!-- </logTransformedNormalReferencePrior> -->
					<!-- <normalReferencePrior id="X.attenuation.vectors.workingPrior" fileName="SHCA661_ou_symmetric_factor.log" parameterColumn="X.attenuation.vectors" dimension="1" burnin="200000"> -->
						<!-- <parameter idref="X.attenuation.vectors"/> -->
					<!-- </normalReferencePrior> -->
				<!-- </workingPrior> -->
			<!-- </destination> -->
		<!-- </pathLikelihood> -->
		<!-- <log id="MLE.GSS" logEvery="1000" fileName="SHCA661_ou_symmetric_factor.MLE_GSS.log"> -->
			<!-- <pathLikelihood idref="pathLikelihood.GSS"/> -->
			<!-- <prior idref="X.precision.diagonal.prior"/> -->
			<!-- <prior idref="X.precision.offDiagonal.prior"/> -->
			<!-- <prior idref="X.attenuation.values.prior"/> -->
			<!-- <prior idref="X.attenuation.vectors.prior"/> -->
			<!-- <prior idref="X.opt.1.prior"/> -->
			<!-- <prior idref="X.opt.2.prior"/> -->
			<!-- <prior idref="X.precision.diagonal.workingPrior"/> -->
			<!-- <prior idref="X.precision.offDiagonal.workingPrior"/> -->
			<!-- <prior idref="X.attenuation.values.workingPrior"/> -->
			<!-- <prior idref="X.attenuation.vectors.workingPrior"/> -->
			<!-- <prior idref="X.opt.1.workingPrior"/> -->
			<!-- <prior idref="X.opt.2.workingPrior"/> -->
		<!-- </log> -->
	<!-- </marginalLikelihoodEstimator> -->
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>
</beast>
