<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.6.1                                              -->
<!--       by Alexei J. Drummond and Andrew Rambaut                          -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       http://beast.bio.ed.ac.uk/                                        -->
<beast>
	<!-- The list of taxa analyse (can also include dates/ages).                 -->
	<taxa id="taxa">
		<taxon id="X">
			<date value="0" direction="backwards" units="days"/>
			<attr name="geography">1</attr>
		</taxon>
		<taxon id="Y">
			<date value="4" direction="backwards" units="days"/>
			<attr name="geography">2</attr>
		</taxon>
	</taxa>

	<!-- Number Of States = 7                                                     -->
	<generalDataType id="geography.dataType">
		<state code="1"/>
		<state code="2"/>
	</generalDataType>

	<attributePatterns id="geography.attributePatterns" attribute="geography">
		<taxa idref="taxa"/>
		<generalDataType idref="geography.dataType"/>
	</attributePatterns>
	
	<!-- Tree model: a fixed chronogram -->
	<newick id="startingTree" units="days" usingDates="true">
		(X:7,Y:3);
	</newick>
	<treeModel id="treeModel">
		<tree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<!-- The strict clock (Uniform rates across branches)                        -->
	<strictClockBranchRates id="geography.branchRates">
		<rate>
			<parameter id="geography.clock.rate" value="0.1" lower="0.0" upper="Infinity"/>
		</rate>
	</strictClockBranchRates>
	
	<!-- asymmetric CTMC model for discrete state reconstructions                -->
	<!-- specifying epochs -->
	<frequencyModel id="geography.root.frequencyModel" normalize="true">
		<generalDataType idref="geography.dataType"/>
		<frequencies>
			<parameter id="geography.root.frequencies" dimension="2"/>
		</frequencies>
	</frequencyModel>
	
	<generalSubstitutionModel id="geography.model.epoch1">
		<generalDataType idref="geography.dataType"/>
		<frequencies>
			<frequencyModel id="geography.frequencyModel.epoch1" normalize="true">
				<generalDataType idref="geography.dataType"/>
				<frequencies>
					<parameter id="geography.frequencies.epoch1" dimension="2"/>
				</frequencies>
			</frequencyModel>
		</frequencies>
		<rates>
			<parameter id="geography.rates.epoch1" dimension="2" value="0.9 0.1"/>
		</rates>
	</generalSubstitutionModel>
	
	<generalSubstitutionModel id="geography.model.epoch2">
		<generalDataType idref="geography.dataType"/>
		<frequencies>
			<frequencyModel id="geography.frequencyModel.epoch2" normalize="true">
				<generalDataType idref="geography.dataType"/>
				<frequencies>
					<parameter id="geography.frequencies.epoch2" dimension="2"/>
				</frequencies>
			</frequencyModel>
		</frequencies>
		<rates>
			<parameter id="geography.rates.epoch2" dimension="2" value="0.7 0.3"/>
		</rates>
	</generalSubstitutionModel>
	
	<generalSubstitutionModel id="geography.model.epoch3">
		<generalDataType idref="geography.dataType"/>
		<frequencies>
			<frequencyModel id="geography.frequencyModel.epoch3" normalize="true">
				<generalDataType idref="geography.dataType"/>
				<frequencies>
					<parameter id="geography.frequencies.epoch3" dimension="2"/>
				</frequencies>
			</frequencyModel>
		</frequencies>
		<rates>
			<parameter id="geography.rates.epoch3" dimension="2" value="0.2 0.8"/>
		</rates>
	</generalSubstitutionModel>
	
	<generalSubstitutionModel id="geography.model.epoch4">
		<generalDataType idref="geography.dataType"/>
		<frequencies>
			<frequencyModel id="geography.frequencyModel.epoch4" normalize="true">
				<generalDataType idref="geography.dataType"/>
				<frequencies>
					<parameter id="geography.frequencies.epoch4" dimension="2"/>
				</frequencies>
			</frequencyModel>
		</frequencies>
		<rates>
			<parameter id="geography.rates.epoch4" dimension="2" value="0.5 0.5"/>
		</rates>
	</generalSubstitutionModel>
	
	<epochBranchModel id="geography.epochModel">
		<epoch transitionTime="2">
			<generalSubstitutionModel idref="geography.model.epoch1"/>
		</epoch>
		<epoch transitionTime="4">
			<generalSubstitutionModel idref="geography.model.epoch2"/>
		</epoch>
		<epoch transitionTime="6">
			<generalSubstitutionModel idref="geography.model.epoch3"/>
		</epoch>
		<generalSubstitutionModel idref="geography.model.epoch4"/>
		<treeModel idref="treeModel"/>
    </epochBranchModel>
	<siteModel id="geography.siteModel">
		<branchSubstitutionModel>
			<epochBranchModel idref="geography.epochModel"/>
		</branchSubstitutionModel>
	</siteModel>
	
	<treeLikelihood id="geography.treeLikelihood">
        <patterns idref="geography.attributePatterns"/>
        <treeModel idref="treeModel"/>
        <siteModel idref="geography.siteModel"/>
		<epochBranchModel idref="geography.epochModel"/>
		<strictClockBranchRates idref="geography.branchRates"/>
		<frequencyModel idref="geography.root.frequencyModel"/>
	</treeLikelihood>
	
	<treeDataLikelihood id="geography.treeDataLikelihood">
        <patterns idref="geography.attributePatterns"/>
        <treeModel idref="treeModel"/>
        <siteModel idref="geography.siteModel"/>
		<epochBranchModel idref="geography.epochModel"/>
		<strictClockBranchRates idref="geography.branchRates"/>
		<frequencyModel idref="geography.root.frequencyModel"/>
	</treeDataLikelihood>	
	
	<report>
		first = <treeLikelihood idref="geography.treeLikelihood"/>
    </report>
    
	<report>
        second = <treeDataLikelihood idref="geography.treeDataLikelihood"/>
    </report> 
    

	
    <assertEqual tolerance="1e-3" verbose="true" charactersToStrip="\[\],">
        <message>
            Check treeLikelihood
        </message>
       <actual regex="BeagleTreeLikelihood\((.*?)\)\n">
	       <treeLikelihood idref="geography.treeLikelihood"/>            
        </actual>
        <expected>
	         -2.17228
        </expected>
    </assertEqual>	
    
    <assertEqual tolerance="1e-3" verbose="true" charactersToStrip="\[\],">
        <message>
            Check treeDataLikelihood
        </message>
       <actual regex="TreeDataLikelihood\((.*?)\)\n">
	       <treeLikelihood idref="geography.treeDataLikelihood"/>            
        </actual>
        <expected>
	         -2.17228
        </expected>    
    </assertEqual>		
	

</beast>
